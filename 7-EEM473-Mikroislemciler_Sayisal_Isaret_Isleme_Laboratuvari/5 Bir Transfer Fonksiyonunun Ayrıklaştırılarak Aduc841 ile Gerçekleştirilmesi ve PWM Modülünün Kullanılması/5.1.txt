#include<Aduc841.h>
;------------------
GIRIS		EQU 20H
CIKIS_L		EQU 21H
CIKIS_H 	EQU 22H
GERI_BESLEME_L		EQU 23H
GERI_BESLEME_H 		EQU 24H
GECIKME1_L 			EQU 25H
GECIKME1_H 			EQU 26H
GECIKME2_L 			EQU 27H
GECIKME2_H 			EQU 28H
TOPLAM_L 			EQU 29H
TOPLAM_H 			EQU 2AH

SAY2_L EQU 00H
SAY2_H EQU 01H
SAY1_L EQU 02H
SAY1_H EQU 03H
SONUC_BYTE_1 EQU 00H
SONUC_BYTE_2 EQU 01H
SONUC_BYTE_3 EQU 02H
SONUC_BYTE_4 EQU 03H

KATSAYI_A_L EQU 2CH
KATSAYI_A_H EQU 2DH
KATSAYI_C_L EQU 2EH
KATSAYI_C_H EQU 2FH
;----------------------
CSEG
ORG 00H
SJMP MAIN

ORG 0BH
SJMP TIMER0_KESME
;---------------------
MAIN:
;DAC AYAR---------
MOV DACCON, #01111111B
MOV DAC0H, #00H
MOV DAC0L, #00H
;TIMER0 AYAR---------
MOV TMOD, #00000001B
MOV TL0, #0ADH
MOV TH0, #0FBH
;TIMER0 KESME AYARI---------
SETB EA
SETB ET0
;DEGISKEN ILK DEGERLER
MOV SP,	#040H
MOV GECIKME1_L, #00H
MOV GECIKME1_H, #00H
MOV GECIKME2_H, #00H
MOV GECIKME2_L, #00H
MOV GIRIS,	#03H

MOV KATSAYI_A_H, #10H
MOV KATSAYI_A_L, #13H
MOV KATSAYI_C_H, #0FFH
MOV KATSAYI_C_L, #07CH
SETB TR0
BEKLE:
SJMP BEKLE
;--------------------
TIMER0_KESME:
MOV DAC0H, CIKIS_H
MOV DAC0L, CIKIS_L

MOV TL0, #0ADH
MOV TH0, #0FBH

ACALL HESAP_CIKIS
ACALL HESAP_GERIBESLEME
ACALL HESAP_TOPLAM
ACALL HESAP_GECIKME2
ACALL HESAP_GECIKME1

RETI

HESAP_CIKIS:
MOV KATSAYI_A_H, #00H
MOV KATSAYI_A_L, #03H

MOV SAY2_L, GECIKME1_L
MOV SAY2_H, GECIKME1_H
MOV SAY1_L, KATSAYI_A_L
MOV SAY1_H, KATSAYI_A_H
ACALL CARP_SAYI2xSAYI1

MOV CIKIS_L, SONUC_BYTE_1
MOV CIKIS_H, SONUC_BYTE_2

RET
;---------------------
HESAP_GERIBESLEME:
MOV SAY2_L, GECIKME1_L
MOV SAY2_H, GECIKME1_H
MOV SAY1_L, #02H
MOV SAY1_H, #00H

ACALL CARP_SAYI2xSAYI1

MOV SAY2_L, SONUC_BYTE_1
MOV SAY2_H, SONUC_BYTE_2
MOV SAY1_L, KATSAYI_C_L
MOV SAY1_H, KATSAYI_C_H

ACALL CARP_SAYI2xSAYI1

MOV SAY2_L, SONUC_BYTE_3
MOV SAY2_H, SONUC_BYTE_4
MOV SAY1_L, GECIKME2_L
MOV SAY1_H, GECIKME2_H

ACALL FARK_SAYI2_SAYI1

MOV GERI_BESLEME_L, SONUC_BYTE_1
MOV GERI_BESLEME_H, SONUC_BYTE_2
RET
;------------------------
HESAP_TOPLAM:
MOV ACC, GIRIS
ADD A, GERI_BESLEME_L
MOV TOPLAM_L, A
ADDC A, GERI_BESLEME_H
MOV TOPLAM_H, A
RET
;-----------------------------
FARK_SAYI2_SAYI1:

MOV ACC, SAY2_L
CLR C
SUBB A, SAY1_L

MOV SONUC_BYTE_1, A
MOV A, SAY2_H
SUBB A, SAY1_H

MOV SONUC_BYTE_2, A
RET
;---------------------
HESAP_GECIKME2:

MOV GECIKME2_L, GECIKME1_L
MOV GECIKME2_H, GECIKME1_H
RET
;------------------
HESAP_GECIKME1:
MOV GECIKME1_L, TOPLAM_L
MOV GECIKME1_H, TOPLAM_H
RET
;------------------
CARP_SAYI2xSAYI1:
	push b
	push dpl
	mov a,r0
	mov b, r2
	mul ab
	push acc
	push b
	mov a, r0
	mov b,r3
	mul ab 
	pop 00h
	add a,r0
	mov r0,a
	clr a
	addc a,b
	mov dpl,a
	mov a, r2
	mov b, r1
	mul ab
	add a,r0
	mov r0,a
	mov a,dpl
	addc a,b
	mov dpl,a
	clr a
	addc a, #00h
	push acc
	mov a, r3
	mov b,r1
	mul ab
	add a,dpl
	mov r2, a
	pop acc
	addc a,b
	mov r3,a
	mov r1, 00h
	pop 00h
	pop dpl
	pop b
	
	RET
	;---------------------
	END